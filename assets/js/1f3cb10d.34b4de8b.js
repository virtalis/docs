"use strict";(self.webpackChunkvirtalis_docs=self.webpackChunkvirtalis_docs||[]).push([[17423],{59433:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"visionary-render-programming/plugins/tutorials/context-menu","title":"Add a Context Menu","description":"Introduction","source":"@site/docs/visionary-render-programming/plugins/tutorials/context-menu.mdx","sourceDirName":"visionary-render-programming/plugins/tutorials","slug":"/visionary-render-programming/plugins/tutorials/context-menu","permalink":"/visionary-render-programming/plugins/tutorials/context-menu","draft":false,"unlisted":false,"editUrl":"https://github.com/virtalis/docs/tree/master/docs/visionary-render-programming/plugins/tutorials/context-menu.mdx","tags":[],"version":"current","lastUpdatedAt":1730817102000,"frontMatter":{},"sidebar":"visionaryRenderProgrammingSidebar","previous":{"title":"Write to the Application Log","permalink":"/visionary-render-programming/plugins/tutorials/app-log"},"next":{"title":"Define a Custom MetaNode","permalink":"/visionary-render-programming/plugins/tutorials/custom-metanode"}}');var a=t(74848),i=t(28453),o=t(11470),s=t(19365);const l={},c="Add a Context Menu",d={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Node Creation",id:"node-creation",level:2},{value:"Example Code",id:"example-code",level:2},{value:"Setting up a Callback",id:"setting-up-a-callback",level:2},{value:"Native Callback",id:"native-callback",level:3},{value:"Other Callback Types",id:"other-callback-types",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"add-a-context-menu",children:"Add a Context Menu"})}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(n.p,{children:"A plugin may provide functionality triggered by context menu options."}),"\n",(0,a.jsx)(n.p,{children:"Doing this involves creating menu entry nodes directly in the context menu tree."}),"\n",(0,a.jsxs)(n.p,{children:["The context menu is located in the local user's tree. This is visible in the Developer tree  (with the ",(0,a.jsx)(n.code,{children:"User Interface / Advanced / Developer Admin Mode"})," setting enabled)."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(64661).A+"",width:"509",height:"540"})}),"\n",(0,a.jsx)(n.h2,{id:"node-creation",children:"Node Creation"}),"\n",(0,a.jsxs)(n.p,{children:["The local user node (VRGetThisUser) contains the context menu, which is accessible by searching for ",(0,a.jsx)(n.code,{children:'"ApplicationMenus/ContextMenu"'})," using VRFind."]}),"\n",(0,a.jsx)(n.p,{children:"From here, any nodes created will appear in the root of the menu. Menu nodes can be nested to create sub-menus."}),"\n",(0,a.jsxs)(n.p,{children:["The type of node to create is an ",(0,a.jsx)(n.code,{children:"ApplicationMenuEntry"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"example-code",children:"Example Code"}),"\n",(0,a.jsxs)(o.A,{children:[(0,a.jsx)(s.A,{value:"c",label:"C",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:'PLUGIN_ENTRY_POINT int VRTREE_APIENTRY VRPInit()\r\n{\r\n  VRPLUGIN_LOADVRTREE;\r\n    \r\n  // get the user node\r\n  HNode user = VRGetThisUser();\r\n  \r\n  // find the context menu\r\n  HNode menuRoot = VRFind(user, "ApplicationMenus/ContextMenu");\r\n  \r\n  // identify the version of the menu entry metanode (plugin compatibility)\r\n  char entryMetaName[100];\r\n  VRCurrentMetaNodeVersion("ApplicationMenuEntry", entryMetaName, 100);\r\n  \r\n  // add a new menu item\r\n  HNode menuItem = VRCreateNode(menuRoot, entryMetaName, "MyMenuNode");\r\n  \r\n  // set the caption for the gui\r\n  VRSetPropertyString(menuItem, "Caption", "My Menu Item");\r\n  \r\n  VRCloseNodeHandle(menuItem);\r\n  VRCloseNodeHandle(menuRoot);\r\n  VRCloseNodeHandle(user);\r\n}\n'})})}),(0,a.jsx)(s.A,{value:"cpp",label:"C++",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:'PLUGIN_ENTRY_POINT int VRTREE_APIENTRY VRPInit()\r\n{\r\n  VRPLUGIN_LOADVRTREE;\r\n  \r\n  // get the user node\r\n  HNodeR user = VRGetThisUser();\r\n  \r\n  // find the context menu\r\n  HNodeR menuRoot = VRFind(user, "ApplicationMenus/ContextMenu");\r\n  \r\n  // identify the version of the menu entry metanode (plugin compatibility)\r\n  char entryMetaName[100];\r\n  VRCurrentMetaNodeVersion("ApplicationMenuEntry", entryMetaName, 100);\r\n  \r\n  // add a new menu item\r\n  HNodeR menuItem = VRCreateNode(menuRoot, \r\n                                 VRCurrentMetaNodeVersion("ApplicationMenuEntry"),\r\n                                 "MyMenuNode");\r\n  \r\n  // set the caption for the gui\r\n  VRSetPropertyString(menuItem, "Caption", "My Menu Item");\r\n}\n'})})}),(0,a.jsx)(s.A,{value:"lua",label:"Lua",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'local function init()\r\n  -- existing initialisation code...\r\n\r\n  -- get the menu root\r\n  local menuRoot = vrLocalUserNode():find("ApplicationMenus/ContextMenu")\r\n  \r\n  -- create the entry directly - Lua operates in unversioned metanode names.\r\n  local menuItem = vrCreateNode("ApplicationMenuEntry", "MyMenuNode", menuRoot)\r\n  \r\n  -- set the caption for the gui\r\n  menuItem.Caption = "Lua Function";\r\nend\n'})})})]}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-a-callback",children:"Setting up a Callback"}),"\n",(0,a.jsx)(n.p,{children:"Adding the menu function alone doesn't do a lot - it needs to be given a type and a command to execute."}),"\n",(0,a.jsxs)(n.p,{children:["For native plugins, this should be done with the ",(0,a.jsx)(n.code,{children:"Function"})," type. For Lua, it should be done with the ",(0,a.jsx)(n.code,{children:"Lua"})," type. These type options allow the ",(0,a.jsx)(n.code,{children:"Command"})," property to be given the name of the function to call when the menu item is selected."]}),"\n",(0,a.jsx)(n.h3,{id:"native-callback",children:"Native Callback"}),"\n",(0,a.jsx)(n.p,{children:"With the exception of Lua, the callback function should be registered using a unique name, with VRRegisterEventFunction."}),"\n",(0,a.jsxs)(n.p,{children:["This type of callback function does not receive any parameters. Instead it should read the registers set by the event system. For more details, see ",(0,a.jsx)(n.a,{href:"/visionary-render-programming/plugins/tutorials/ffi",children:"Foreign Function Interface"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Lua callbacks recieve the selected node in their first parameter. Native callbacks should read the selected node out of the ",(0,a.jsx)(n.code,{children:"__TargetNode"})," register."]}),"\n",(0,a.jsxs)(n.p,{children:["This function can then be referenced by name in the ",(0,a.jsx)(n.code,{children:"Command"})," property on the menu node."]}),"\n",(0,a.jsxs)(o.A,{children:[(0,a.jsx)(s.A,{value:"c",label:"C",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:'static void myCallback(void* userData) \r\n{\r\n  // do things in response to the menu execution\r\n  HFFIVar nodeVar = VRFFIGetEventRegister("__TargetNode");\r\n  HNode node = VRFFIGetNode(nodeVar);\r\n  //node was the one the context menu was summoned on...\r\n  VRCloseNodeHandle(node);\r\n  VRFFIFree(nodeVar);\r\n}\r\n\r\nPLUGIN_ENTRY_POINT int VRTREE_APIENTRY VRPInit()\r\n{\r\n  VRPLUGIN_LOADVRTREE;\r\n    \r\n  VRRegisterEventFunction("myCallback", &myCallback, NULL);\r\n\r\n  ...\r\n\r\n  // we can now configure our menu item (see previous example code)\r\n  VRSetPropertyEnum(menuItem, "Type", "TypeFunction");\r\n  VRSetPropertyString(menuItem, "Command", "myCallback");\r\n}\n'})})}),(0,a.jsx)(s.A,{value:"cpp",label:"C++",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cpp",children:'static void myCallback(void* userData) \r\n{\r\n  // do things in response to the menu execution\r\n  HFFIVarR nodeVar = VRFFIGetEventRegister("__TargetNode");\r\n  HNodeR node = VRFFIGetNode(nodeVar);\r\n  //node was the one the context menu was summoned on...\r\n}\r\n\r\nPLUGIN_ENTRY_POINT int VRTREE_APIENTRY VRPInit()\r\n{\r\n  VRPLUGIN_LOADVRTREE;\r\n    \r\n  VRRegisterEventFunction("myCallback", &myCallback, nullptr);\r\n  \r\n  ...\r\n    \r\n  // we can now configure our menu item (see previous example code)\r\n  VRSetPropertyEnum(menuItem, "Type", "TypeFunction");\r\n  VRSetPropertyString(menuItem, "Command", "myCallback");\r\n}\n'})})}),(0,a.jsx)(s.A,{value:"lua",label:"Lua",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-lua",children:'local function myCallback(node)\r\n  -- do things in response to menu execution\r\n  -- node was the one the context menu was summoned on...\r\nend\r\n\r\nlocal function init()\r\n  -- existing initialisation code...\r\n  \r\n  menuItem.Type = __ApplicationMenuEntry_TypeLua -- types are Lua globals\r\n  menuItem.Command = "testplugin.myCallback" -- prefix our plugin name\r\nend\r\n\r\nreturn {\r\n  -- alongside existing exports\r\n  myCallback = myCallback\r\n}\n'})})})]}),"\n",(0,a.jsx)(n.h3,{id:"other-callback-types",children:"Other Callback Types"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"Type"})," property on the menu item has a few other values which allow more specific behaviour with no need for additional callbacks."]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Purpose"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeApp"})}),(0,a.jsxs)(n.td,{children:["Triggers an ",(0,a.jsx)(n.a,{href:"/visionary-render-programming/scripts/advanced/app-commands",children:"application command"})," specified in the ",(0,a.jsx)(n.code,{children:"Command"})," property of the menu item. It may also pass a parameter specified by the ",(0,a.jsx)(n.code,{children:"UserString"})," property of the menu item, if required."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeLua"})}),(0,a.jsxs)(n.td,{children:["Triggers a Lua function named in the ",(0,a.jsx)(n.code,{children:"Command"})," property. It may also pass a parameter specified by the ",(0,a.jsx)(n.code,{children:"UserString"})," property, if required."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeLuaBlock"})}),(0,a.jsxs)(n.td,{children:["Executes a block of Lua code specified in the ",(0,a.jsx)(n.code,{children:"Command"})," property"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypePropertyToggle"})}),(0,a.jsxs)(n.td,{children:["Toggles the value of the property named in the ",(0,a.jsx)(n.code,{children:"Command"})," property (must be a boolean property), on the node at the path specified in the ",(0,a.jsx)(n.code,{children:"UserString"})," property. The path is relative to this menu node."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeSettingToggle"})}),(0,a.jsxs)(n.td,{children:["Toggles the value of the setting referenced by the ",(0,a.jsx)(n.code,{children:"UserString"})," property (must be a boolean setting)."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeActivate"})}),(0,a.jsxs)(n.td,{children:["Triggers an Activate event on the menu node itself, executing any attached EventHandler nodes with events set to ",(0,a.jsx)(n.code,{children:"Event_Activate"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TypeFunction"})}),(0,a.jsx)(n.td,{children:"Calls a named function registered with the script engine (VRRegisterEventFunction)"})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var r=t(34164);const a={tabItem:"tabItem_Ymn6"};var i=t(74848);function o({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,t),hidden:n,children:e})}},11470:(e,n,t)=>{t.d(n,{A:()=>R});var r=t(96540),a=t(34164),i=t(23104),o=t(56347),s=t(205),l=t(57485),c=t(31682),d=t(70679);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(t.location.search);n.set(a,e),t.replace({...t.location,search:n.toString()})}),[a,t])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,i=h(e),[o,l]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[c,u]=m({queryString:t,groupId:a}),[x,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,a]=(0,d.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:a}),y=(()=>{const e=c??x;return p({value:e,tabValues:i})?e:null})();(0,s.A)((()=>{y&&l(y)}),[y]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),g(e)}),[u,g,i]),tabValues:i}}var g=t(92303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function f({className:e,block:n,selectedValue:t,selectValue:r,tabValues:o}){const s=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const n=e.currentTarget,a=s.indexOf(n),i=o[a].value;i!==t&&(l(n),r(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=s.indexOf(e.currentTarget)+1;n=s[t]??s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;n=s[t]??s[s.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:o.map((({value:e,label:n,attributes:r})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{s.push(e)},onKeyDown:d,onClick:c,...r,className:(0,a.A)("tabs__item",y.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function v({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function j(e){const n=x(e);return(0,b.jsxs)("div",{className:(0,a.A)("tabs-container",y.tabList),children:[(0,b.jsx)(f,{...n,...e}),(0,b.jsx)(v,{...n,...e})]})}function R(e){const n=(0,g.A)();return(0,b.jsx)(j,{...e,children:u(e.children)},String(n))}},64661:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/context-menu-nodes-5e7b6f948344d7f98552921327bc3f03.png"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(96540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);