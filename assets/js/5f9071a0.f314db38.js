"use strict";(self.webpackChunkvirtalis_docs=self.webpackChunkvirtalis_docs||[]).push([[5922],{73627:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"virtalis-hub-system-admin/configure/change-domain","title":"Change the Domain of an Existing Installation","description":"This section describes how to reconfigure an existing installation of Virtalis Hub to use a different domain. It assumes that you have already installed Virtalis Hub and your shell is in the directory containing the files that were downloaded during the installation. This is usually stored in the home directory, for example /home/root/Hub/k8s","source":"@site/docs/virtalis-hub-system-admin/configure/change-domain.mdx","sourceDirName":"virtalis-hub-system-admin/configure","slug":"/virtalis-hub-system-admin/configure/change-domain","permalink":"/virtalis-hub-system-admin/configure/change-domain","draft":false,"unlisted":false,"editUrl":"https://github.com/virtalis/docs/tree/master/docs/virtalis-hub-system-admin/configure/change-domain.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"virtalisHubSystemAdminSidebar","previous":{"title":"Automated Backup System","permalink":"/virtalis-hub-system-admin/configure/automated-backup"},"next":{"title":"Manually Erasing Data","permalink":"/virtalis-hub-system-admin/configure/erase-data"}}');var a=t(74848),s=t(28453);const o={},r="Change the Domain of an Existing Installation",l={},d=[{value:"Set Up Variables",id:"set-up-variables",level:2},{value:"Updating tls Certificates (Optional)",id:"updating-tls-certificates-optional",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"change-the-domain-of-an-existing-installation",children:"Change the Domain of an Existing Installation"})}),"\n",(0,a.jsxs)(n.p,{children:["This section describes how to reconfigure an existing installation of Virtalis Hub to use a different domain. It assumes that you have already installed Virtalis Hub and your shell is in the directory containing the files that were downloaded during the installation. This is usually stored in the home directory, for example ",(0,a.jsx)(n.code,{children:"/home/root/Hub/k8s"})]}),"\n",(0,a.jsx)(n.h2,{id:"set-up-variables",children:"Set Up Variables"}),"\n",(0,a.jsx)(n.p,{children:"Export the following variables:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'export HUB_NAMESPACE=hub\r\nexport SKIP_MIGRATIONS=1\r\nexport HUB_VERSION=$(kubectl get secret hub-version -n $HUB_NAMESPACE  -o json | jq ".data.version" -r | base64 -d)\r\nexport ACR_REGISTRY_NAME=$(kubectl get secret hub-install-config -n $HUB_NAMESPACE  -o json | jq ".data.ACR_REGISTRY_NAME" -r | base64 -d)\r\nexport ACR_USERNAME=$(kubectl get secret hub-install-config -n $HUB_NAMESPACE  -o json | jq ".data.ACR_USERNAME" -r | base64 -d)\r\nexport ACR_PASSWORD=$(kubectl get secret hub-install-config -n $HUB_NAMESPACE  -o json | jq ".data.ACR_PASSWORD" -r | base64 -d)\n'})}),"\n",(0,a.jsx)(n.p,{children:"Load previous configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:". ./load-install-config.sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Substitute and export the following variables:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"export HUB_DOMAIN=<new domain>\n"})}),"\n",(0,a.jsx)(n.p,{children:"Apply Change"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"./deploy.sh\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Applying Manual Changes in Keycloak\r\nNavigate to ",(0,a.jsx)(n.code,{children:"https://<new domain>/auth/admin"})," in your browser and log in to access the Keycloak admin panel."]}),"\n",(0,a.jsxs)(n.p,{children:["Navigate to ",(0,a.jsx)(n.code,{children:"https://<new domain>/auth/admin/master/console/#/realms/hub/clients"})]}),"\n",(0,a.jsx)(n.p,{children:"Open and edit the following clients from the list:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"file-import\r\njob-status\r\nproject-author\r\nhub-client\n"})}),"\n",(0,a.jsx)(n.p,{children:"Staying on the default Settings section, edit any fields that contain the old domain to reflect the new domain, ensuring to keep the protocol and any arguments in the field. For example, edit fields containing hub.local to a new domain, hubnew.local:"}),"\n",(0,a.jsx)(n.p,{children:"Press Save at the bottom of the individual client settings page."}),"\n",(0,a.jsx)(n.h2,{id:"updating-tls-certificates-optional",children:"Updating tls Certificates (Optional)"}),"\n",(0,a.jsx)(n.p,{children:"Depending on your configuration, if you provision a tls certificate for your ingress it will need to be updated with a new certificate signed for the new domain."}),"\n",(0,a.jsx)(n.p,{children:"Delete old certificate:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'kubectl delete secret "${TLS_SECRET_NAME}" -n "${HUB_NAMESPACE}"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Create new certificate:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'kubectl create secret tls -n "${HUB_NAMESPACE}" \\\r\n"${TLS_SECRET_NAME}" --key="tls.key" --cert="tls.crt"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(96540);const a={},s=i.createContext(a);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);