"use strict";(self.webpackChunkvirtalis_docs=self.webpackChunkvirtalis_docs||[]).push([[85822],{88282:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"visionary-render-programming/plugins/getting-started/lua-plugins","title":"Lua Plugins","description":"Search Paths","source":"@site/docs/visionary-render-programming/plugins/getting-started/lua-plugins.mdx","sourceDirName":"visionary-render-programming/plugins/getting-started","slug":"/visionary-render-programming/plugins/getting-started/lua-plugins","permalink":"/visionary-render-programming/plugins/getting-started/lua-plugins","draft":false,"unlisted":false,"editUrl":"https://github.com/virtalis/docs/tree/master/docs/visionary-render-programming/plugins/getting-started/lua-plugins.mdx","tags":[],"version":"current","lastUpdatedAt":1742892037000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"visionaryRenderProgrammingSidebar","previous":{"title":"Plugins Window","permalink":"/visionary-render-programming/plugins/getting-started/plugins-window"},"next":{"title":"Native Plugins","permalink":"/visionary-render-programming/plugins/getting-started/native-plugins"}}');var r=i(74848),a=i(28453),s=i(11470),l=i(19365);const o={sidebar_position:2},u="Lua Plugins",d={},c=[{value:"Search Paths",id:"search-paths",level:2},{value:"Modules",id:"modules",level:2},{value:"Plugins",id:"plugins",level:2},{value:"Example Code",id:"example-code",level:3},{value:"Usage",id:"usage",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"lua-plugins",children:"Lua Plugins"})}),"\n",(0,r.jsx)(n.h2,{id:"search-paths",children:"Search Paths"}),"\n",(0,r.jsx)(n.p,{children:"Lua plugins are loaded at start-up, and can be found in the following locations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<install_root>/plugins"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<install_root>/data/plugins"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<doc_dir>/plugins"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"%VRTREE_PLUGINS_DIR%"})," (environment variable)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Where:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<install_root>"})," is the location where Visionary Render is installed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<doc_dir>"})," is ",(0,r.jsx)(n.code,{children:"Documents/VisionaryRender"})," or similar (side-by-side installs use ",(0,r.jsx)(n.code,{children:"Documents/VisionaryRender-X.X.X"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The search behavior for ",(0,r.jsx)(n.code,{children:"/plugins"})," directories is to look for a sub-folder containing a ",(0,r.jsx)(n.code,{children:".lua"})," file of the same name. For example, ",(0,r.jsx)(n.code,{children:"plugins/my_plugin/my_plugin.lua"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"modules",children:"Modules"}),"\n",(0,r.jsxs)(n.p,{children:["A module is a container for related functionality that can be 'required' (i.e. included) by other Lua scripts. There are various ways to implement a module in Lua. For Visionary Render plugins, any method can be used. For an overview of these methods, see the ",(0,r.jsx)(n.a,{href:"http://lua-users.org/wiki/ModulesTutorial",children:"Modules Tutorial"})," section of the Lua website."]}),"\n",(0,r.jsxs)(n.p,{children:["Older modules used the ",(0,r.jsx)(n.code,{children:"module"})," method where code had no direct access to global variables. Instead the author had to localise them before calling ",(0,r.jsx)(n.code,{children:"module"})," (e.g. ",(0,r.jsx)(n.code,{children:"local print = print"}),"). This tends to make developing a module more difficult. Our new recommended way to develop Lua modules is to make everything inside the module ",(0,r.jsx)(n.code,{children:"local"}),", and explicitly expose the functions that should be available to the user of the module. This is demonstrated as part of the Lua plugin example code below."]}),"\n",(0,r.jsx)(n.h2,{id:"plugins",children:"Plugins"}),"\n",(0,r.jsxs)(n.p,{children:["A Lua plugin in Visionary Render has full access to everything that a normal event script does - i.e. the full ",(0,r.jsx)(n.a,{href:"/visionary-render-programming/reference/lua-api/modules/core",children:"Lua API"}),". To instruct Visionary Render to load a Lua plugin, the quickest way is to put the ",(0,r.jsx)(n.code,{children:".lua"})," file in ",(0,r.jsx)(n.code,{children:"Documents/Visionary Render/plugins/<lua file name>/<lua file name>.lua"}),"\r\n(e.g. ",(0,r.jsx)(n.code,{children:"plugins/myplugin/myplugin.lua"}),"). A Lua plugin requires the following functions to permit it to be loaded by the plugin manager in Visionary Render:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Function"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name()"})}),(0,r.jsx)(n.td,{children:"This should return a human-readable name for this plugin to be used to display this plugin in the plugin manager settings."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"version()"})}),(0,r.jsx)(n.td,{children:"This should return the version number, which is also used in the plugin manager settings."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"init()"})}),(0,r.jsx)(n.td,{children:"This is called once when the plugin is loaded, and should initialise any necessary objects such as VRTree nodes or menu items, etc."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"cleanup()"})}),(0,r.jsxs)(n.td,{children:["This is called once when the plugin is unloaded, and should delete anything that ",(0,r.jsx)(n.code,{children:"init()"})," added to VRTree. See ",(0,r.jsx)(n.a,{href:"/visionary-render-programming/plugins/advanced/dynamic-loading",children:"dynamic loading"})," for more information. (Optional)"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"example-code",children:"Example Code"}),"\n",(0,r.jsx)(n.p,{children:"The following example shows how to create a simple plugin:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",metastring:'title="myplugin.lua"',children:'local function name()\r\n  -- Return the name of the plugin.\r\n  return "My Plugin"\r\nend\r\n\r\nlocal function version()\r\n  -- Return the version number of the plugin.\r\n  return "1.0.0"\r\nend\r\n\r\nlocal function init()\r\n  -- Do something to initialise the plugin here...\r\n  print("Init ", name())\r\nend\r\n\r\nlocal function cleanup()\r\n  -- Do something to clean up the plugin here...\r\n  print("Cleanup ", name())\r\nend\r\n\r\n-- Export the plugin functions to the Lua state.\r\nreturn {\r\n  name = name,\r\n  version = version,\r\n  init = init,\r\n  cleanup = cleanup\r\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"You should define the functions in your plugin as local to prevent possible clashes with other plugins or API functions."})}),"\n",(0,r.jsxs)(n.p,{children:["This will result in a ",(0,r.jsx)(n.code,{children:"myplugin"})," table in the global Lua state (named after the plugin file name), containing the four functions we exported. To test the plugin, save it in the location mentioned above, and Launch Visionary Render. Open the Diagnostics window (",(0,r.jsx)(n.code,{children:"Ctrl"})," + ",(0,r.jsx)(n.code,{children:"D"}),"), go to the Log tab, and somewhere in here should be the line ",(0,r.jsx)(n.code,{children:"{LUA} Init My Plugin"})," - this is the output from your first plugin. You can also see this in the lower pane of the Script Editor (",(0,r.jsx)(n.code,{children:"Ctrl"})," + ",(0,r.jsx)(n.code,{children:"L"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"It is important to only define functions and local variables in the plugin script files, and not to execute any code outside of these functions. This is because, when loading the plugin, it is first loaded into a separate sandbox for querying its name and version, in order to check for conflicts with other plugins before exposing it to the main application Lua environment. This sandbox does not have access to any VR Lua functions or anything else in the main application environment."}),"\n",(0,r.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.p,{children:"Any functions exported by the plugin can be accessed in Visionary Render via an Event script or the Console. For example, run the following in the Console:"}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsx)(l.A,{value:"console",label:"Console",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- Print the name of myplugin to the Output panel.\r\nprint(myplugin.name())\n"})})}),(0,r.jsx)(l.A,{value:"output",label:"Output",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"{LUA} My Plugin\n"})})})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},19365:(e,n,i)=>{i.d(n,{A:()=>s});i(96540);var t=i(34164);const r={tabItem:"tabItem_Ymn6"};var a=i(74848);function s({children:e,hidden:n,className:i}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,i),hidden:n,children:e})}},11470:(e,n,i)=>{i.d(n,{A:()=>w});var t=i(96540),r=i(34164),a=i(23104),s=i(56347),l=i(205),o=i(57485),u=i(31682),d=i(70679);function c(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:i}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return c(e).map((({props:{value:e,label:n,attributes:i,default:t}})=>({value:e,label:n,attributes:i,default:t})))}(i);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function g({queryString:e=!1,groupId:n}){const i=(0,s.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,o.aZ)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function m(e){const{defaultValue:n,queryString:i=!1,groupId:r}=e,a=h(e),[s,o]=(0,t.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const i=n.find((e=>e.default))??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:a}))),[u,c]=g({queryString:i,groupId:r}),[m,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[i,r]=(0,d.Dv)(n);return[i,(0,t.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),x=(()=>{const e=u??m;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{x&&o(x)}),[x]);return{selectedValue:s,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),c(e),f(e)}),[c,f,a]),tabValues:a}}var f=i(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=i(74848);function v({className:e,block:n,selectedValue:i,selectValue:t,tabValues:s}){const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),u=e=>{const n=e.currentTarget,r=l.indexOf(n),a=s[r].value;a!==i&&(o(n),t(a))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:s.map((({value:e,label:n,attributes:t})=>(0,b.jsx)("li",{role:"tab",tabIndex:i===e?0:-1,"aria-selected":i===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:u,...t,className:(0,r.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":i===e}),children:n??e},e)))})}function j({lazy:e,children:n,selectedValue:i}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function y(e){const n=m(e);return(0,b.jsxs)("div",{className:(0,r.A)("tabs-container",x.tabList),children:[(0,b.jsx)(v,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function w(e){const n=(0,f.A)();return(0,b.jsx)(y,{...e,children:c(e.children)},String(n))}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(96540);const r={},a=t.createContext(r);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);