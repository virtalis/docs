"use strict";(self.webpackChunkvirtalis_docs=self.webpackChunkvirtalis_docs||[]).push([[49951],{42234:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"virtalis-hub-system-admin/setup/publish-plugin","title":"Install the VirtalisPublish Plugin","description":"VirtalisPublish is a plugin for PTC\u2019s Windchill PLM server software. It allows assemblies to be published to Virtalis Hub when Windchill detects that they have been modified. Once installed and and correctly configured, the general process is as follows.","source":"@site/docs/virtalis-hub-system-admin/setup/publish-plugin.mdx","sourceDirName":"virtalis-hub-system-admin/setup","slug":"/virtalis-hub-system-admin/setup/publish-plugin","permalink":"/virtalis-hub-system-admin/setup/publish-plugin","draft":false,"unlisted":false,"editUrl":"https://github.com/virtalis/docs/tree/master/docs/virtalis-hub-system-admin/setup/publish-plugin.mdx","tags":[],"version":"current","lastUpdatedAt":1740107398000,"frontMatter":{},"sidebar":"virtalisHubSystemAdminSidebar","previous":{"title":"Deploy the Monitoring Service Stack","permalink":"/virtalis-hub-system-admin/setup/deploy-monitoring"},"next":{"title":"Install the Translator Plugins","permalink":"/virtalis-hub-system-admin/setup/translator-plugin"}}');var t=i(74848),s=i(28453);const l={},o="Install the VirtalisPublish Plugin",a={},c=[{value:"\u200dPrerequisites",id:"prerequisites",level:2},{value:"Pre-Installation",id:"pre-installation",level:2},{value:"\u200dLoad the Previous Configuration",id:"load-the-previous-configuration",level:2},{value:"\u200dConfigure RabbitMQ",id:"configure-rabbitmq",level:2},{value:"\u200dConfigure nginx",id:"configure-nginx",level:2},{value:"\u200dCreate a Windchill User",id:"create-a-windchill-user",level:2},{value:"\u200dCreate a Windchill Group",id:"create-a-windchill-group",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuring Windchill",id:"configuring-windchill",level:2},{value:"\u200dConfiguring the Plugin",id:"configuring-the-plugin",level:2},{value:"\u200dVerifying the Installation",id:"verifying-the-installation",level:2},{value:"Testing the Plugin",id:"testing-the-plugin",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"\u200dWindchill Doesn\u2019t Start After Installing the Plugin",id:"windchill-doesnt-start-after-installing-the-plugin",level:3},{value:"Worker Agent Fails to Start",id:"worker-agent-fails-to-start",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"install-the-virtalispublish-plugin",children:"Install the VirtalisPublish Plugin"})}),"\n",(0,t.jsx)(n.p,{children:"VirtalisPublish is a plugin for PTC\u2019s Windchill PLM server software. It allows assemblies to be published to Virtalis Hub when Windchill detects that they have been modified. Once installed and and correctly configured, the general process is as follows."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"\u200dPrerequisites"}),"\n",(0,t.jsx)(n.p,{children:"The processes outlined in this document have been developed and tested on Windchill 11.1."}),"\n",(0,t.jsxs)(n.p,{children:["Throughout this document the base installation folder of Windchill will be referred to as ",(0,t.jsx)(n.code,{children:"<install-folder>"}),", an example would be ",(0,t.jsx)(n.code,{children:"D:\\ptc\\Windchill_11.1\\Windchill"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Creo Elements/Pro (formerly Pro/Engineer) needs to be installed in the Windchill environment. This acts as the \u2018Worker\u2019 that Windchill\u2019s Worker Agent will delegate the job of publishing a representation to, after a successful check-in event."}),"\n",(0,t.jsx)(n.p,{children:"It is assumed that you have already installed Virtalis Hub. After installing the plugin or making any configuration changes, the PTC Windchill service must be restarted for the changes to take effect."}),"\n",(0,t.jsx)(n.h2,{id:"pre-installation",children:"Pre-Installation"}),"\n",(0,t.jsx)(n.p,{children:"You must configure Virtalis Hub to allow for Windchill to talk to the Message Queue. The communication between Windchill and the message queue will be encrypted using TLS."}),"\n",(0,t.jsxs)(n.p,{children:["Export the variables replacing anything in ",(0,t.jsx)(n.code,{children:"<>"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"export HUB_NAMESPACE=<Hub namespace>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"load-the-previous-configuration",children:"\u200dLoad the Previous Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:". ./load-install-config.sh\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker login virtaliscustomer.azurecr.io \\\r\n-u ${ACR_USERNAME} \\\r\n-p ${ACR_PASSWORD}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The next command will generate a password for the client certificates and requires the pwgen package to be available on the command line. This can be substituted for any other command which generates a strong password."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'export MQ_CLIENT_KEY_PASS="$(pwgen 30 1 -s)"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Generate certs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker run --rm \\\r\n-e HUB_DOMAIN=${HUB_DOMAIN} \\\r\n-e MQ_CLIENT_KEY_PASS=${MQ_CLIENT_KEY_PASS} \\\r\n-e TRUSTSTORE_PASSWORD=${TRUSTSTORE_PASSWORD} \\\r\n-v /tmp/result:/tmp/result \\\r\nvirtaliscustomer.azurecr.io/windchill-cert-generator:0.0.0\n"})}),"\n",(0,t.jsx)(n.p,{children:"Create a rabbitmq-certs secret from the generated certs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl create secret generic rabbitmq-certs -n $HUB_NAMESPACE \\\r\n--from-file='ca.crt'=ca_certificate.pem \\\r\n--from-file='tls.crt'=server_certificate.pem \\\r\n--from-file='tls.key'=server_key.pem\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-rabbitmq",children:"\u200dConfigure RabbitMQ"}),"\n",(0,t.jsx)(n.p,{children:"Upgrade RabbitMQ (make sure you are inside the ~/k8s/ directory (default) or wherever else the installation files were downloaded to during the Virtalis Hub installation):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"MQ_EXPOSE_INGRESS=1 ./install-mq.sh\n"})}),"\n",(0,t.jsx)(n.p,{children:"Configure a file source for Windchill by referring to the Configuring External File Sources section of the Deploying Virtalis Hub document and run the script:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"./create-secrets.sh\n"})}),"\n",(0,t.jsx)(n.p,{children:"Check if port 5671 is exposed in the service definition:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl get svc message-queue-rabbitmq -n $HUB_NAMESPACE -o yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"Under the port array you should find amqp-ssl:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"spec:\r\n......\r\n  ports:\r\n.......\r\n  - name: amqp-ssl\r\n    port: 5671\r\n    protocol: TCP\r\n    targetPort: amqp-ssl\r\n......\n"})}),"\n",(0,t.jsx)(n.p,{children:"If it is missing, add it to the service and also to the statefulset:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"  - name: amqp-ssl\r\n    port: 5671\r\n    protocol: TCP\r\n    targetPort: amqp-ssl\r\nkubectl edit statefulset message-queue-rabbitmq -n $HUB_NAMESPACE\n"})}),"\n",(0,t.jsx)(n.p,{children:"Add the following entry under:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"spec\r\ntemplate\r\nspec\r\ncontainers[0]\r\nports\r\n\r\n        - containerPort: 5671\r\n          name: amqp-ssl\r\n          protocol: TCP\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-nginx",children:"\u200dConfigure nginx"}),"\n",(0,t.jsx)(n.p,{children:"Run the command shown below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'cat <<EOF | kubectl apply -f -\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: tcp-services\r\n  namespace: ingress-nginx\r\ndata:\r\n  5673: "$HUB_NAMESPACE/message-queue-rabbitmq:5671"\r\nEOF\n'})}),"\n",(0,t.jsx)(n.p,{children:"This tells nginx to listen on port 5673 and proxy the connection to rabbitmq on port 5672."}),"\n",(0,t.jsx)(n.p,{children:"Run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl edit deploy ingress-nginx-ingress-controller -n ingress-nginx\n"})}),"\n",(0,t.jsx)(n.p,{children:"Under containers.args add these args:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"- --tcp-services-configmap=ingress-nginx/tcp-services\r\n- --enable-ssl-passthrough\n"})}),"\n",(0,t.jsx)(n.p,{children:"Edit the ingress-nginx-controller service and add the new port under spec.ports:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl edit svc ingress-nginx-ingress-controller -n ingress-nginx\r\n ...\r\n ports:\r\n  - name: mq\r\n    port: 5673\r\n    protocol: TCP\r\n    targetPort: 5673\r\n...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-windchill-user",children:"\u200dCreate a Windchill User"}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"<WINDCHILL USER PASSWORD>"})," with a strong random generated password and replace ",(0,t.jsx)(n.code,{children:"<HUB NAMESPACE>"})," with the namespace Virtalis Hub is deployed in and then run the command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl exec -n $HUB_NAMESPACE message-queue-rabbitmq-0 -- /bin/bash -c \\\r\n\"rabbitmqctl add_user 'windchill' '<WINDCHILL USER PASSWORD>' && \\\r\nrabbitmqctl set_permissions -p '/' 'windchill' '^$' '^(amq.default|delay.exchange)$' '^$'\"\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-windchill-group",children:"\u200dCreate a Windchill Group"}),"\n",(0,t.jsxs)(n.p,{children:["In the keycloak admin panel, create a new group with the name \u201cwindchill\u201d and add any users to it that will use the Windchill integration (see ",(0,t.jsx)(n.a,{href:"/virtalis-hub-system-admin/configure/user-management",children:"User Management"})," for further information)."]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.p,{children:"The plugin comes as a Zip file containing two main files:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"VirtalisPublish.jar \u2013 this contains the compiled plugin code required to publish assemblies to Virtalis Hub."}),"\n",(0,t.jsx)(n.li,{children:"virtalisPublish.properties \u2013 a configuration file for tailoring the plugin to your environment."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To install, copy the files to the following locations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["VirtalisPublish.jar: ",(0,t.jsx)(n.code,{children:"<install-folder>/codebase/WEB-INF/lib"})]}),"\n",(0,t.jsxs)(n.li,{children:["virtalisPublish.properties: ",(0,t.jsx)(n.code,{children:"<install-folder>/codebase"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The Zip file also comes with some third-party JAR files (one RabbitMQ AMQP jar required for posting messages to Virtalis Hub\u2019s queue, and three Jackson jar files for JSON serialisation) that will be required if this is a first-time installation. They should also be copied to the ",(0,t.jsx)(n.code,{children:"<install-folder>/codebase/WEB-INF/lib"})," folder if they aren\u2019t already there."]}),"\n",(0,t.jsx)(n.h2,{id:"configuring-windchill",children:"Configuring Windchill"}),"\n",(0,t.jsx)(n.p,{children:"To register the plugin with Windchill and instruct it to execute the plugin at the correct time, make the following modifications to these existing Windchill files."}),"\n",(0,t.jsxs)(n.p,{children:["wt.properties\r\nLocation: ",(0,t.jsx)(n.code,{children:"<install-folder>/codebase/wt.properties"})]}),"\n",(0,t.jsx)(n.p,{children:"The main class in the VirtalisPublisher plugin is called StandardCopyRepsService. It extends the Windchill class wt.service.StandardManager, allowing integration with Windchill\u2019s infrastructure. This class must be registered as a new service within Windchill."}),"\n",(0,t.jsx)(n.p,{children:"In the example below, it is registered as service number 8000. See here for some important notes on the numbering used. It is important to pick a number that\u2019s higher than all the built-in Windchill services that it might need to work."}),"\n",(0,t.jsx)(n.p,{children:"Add an entry similar to this one:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"wt.services.service.8000=co.uk.rootsolutions.virtalis.CopyRepsService/co.uk.rootsolutions.virtalis.StandardCopyRepsService\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"\u200d<site-specific>.xconf"}),"\r\nLocation: ",(0,t.jsx)(n.code,{children:"<install-folder>"})]}),"\n",(0,t.jsxs)(n.p,{children:["All installations have a site.xconf file in ",(0,t.jsx)(n.code,{children:"<install-folder>"}),". This is one of the main Windchill configuration files."]}),"\n",(0,t.jsx)(n.p,{children:"However, changes aren\u2019t allowed to be made to this file because future upgrades could overwrite them. Therefore, installations will have customer-specific configuration files alongside site.xconf, such as virtalis.xconf in our instance. To locate your file, open site.xconf and look for a ConfigurationRef entry similar to the one below. This will tell you which file to make the next changes to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'<ConfigurationRef xlink:href="D:\\ptc\\Windchill_11.1\\Windchill\\virtalis.xconf"/>\n'})}),"\n",(0,t.jsx)(n.p,{children:"If such a file doesn\u2019t exist, you may need to create one. Use the attached virtalis.xconf file as an example, and refer to the documentation here."}),"\n",(0,t.jsx)(n.p,{children:"Locate the entry with a property name set to publish.afterloadermethod, and edit it to look like this. If such an entry doesn\u2019t exist, add one."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'<Property name="publish.afterloadermethod" overridable="true" targetFile="codebase/WEB-INF/conf/wvs.properties"\r\n  value="co.uk.rootsolutions.virtalis.StandardCopyRepsService/copyReps"/>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Next, add an entry for the new service making sure the number (8000 in this case) matches what was specified in wt.properties:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'<Property name="wt.services.service.8000" overridable="true" targetFile="codebase/wt.properties"\r\n  value="co.uk.rootsolutions.virtalis.CopyRepsService/co.uk.rootsolutions.virtalis.StandardCopyRepsService"/>\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u200dwvs.properties"}),"\n",(0,t.jsxs)(n.p,{children:["Location: ",(0,t.jsx)(n.code,{children:"install-folder></codebase/WEB-INF/conf"})]}),"\n",(0,t.jsx)(n.p,{children:"This file also requires a reference to the Virtalis service. Add the following entry:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"publish.afterloadermethod=co.uk.rootsolutions.virtalis.StandardCopyRepsService/copyReps\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-the-plugin",children:"\u200dConfiguring the Plugin"}),"\n",(0,t.jsx)(n.p,{children:"The file virtalisPublish.properties allows various configuration options to be set, which are described below:"}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: copy.logger.location"}),"\n",(0,t.jsxs)(n.p,{children:["Description: Sets location for logger, if left without a value logs will be saved to ",(0,t.jsx)(n.code,{children:"<install-folder>\\logs"})," e.g. ",(0,t.jsx)(n.code,{children:"D:\\\\ptc\\\\VirtalisPublish.log"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"D:/ptc/Virtalis_Download/logs/publisher.txt"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200d\r\n\u200dProperty name: log.verbose"}),"\n",(0,t.jsx)(n.p,{children:"Description: Set log.verbose=true fordebugging purposes."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200d\r\n\u200dProperty name: download.metadata"}),"\n",(0,t.jsx)(n.p,{children:"Description: If true this will create a file for EPMDocument metadata."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"Property name: attribute.names"}),"\n",(0,t.jsx)(n.p,{children:"Description: If download.metadata=true set the list of attributes required here - use internal name & comma delimited."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"name, number,revision,iterationInfo.identifier.iterationId,state.state"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: metadata.file.extension"}),"\n",(0,t.jsx)(n.p,{children:"Description: Setfiletype for metadata file, for example txt or csv"}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"txt"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: download.use.http"}),"\n",(0,t.jsx)(n.p,{children:"Description: If true, the download URL that gets built up and then sent in the message to Virtalis Hub will begin with http. Otherwise (and also default) it will begin with https."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true/false"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: downloadToLocal.dir"}),"\n",(0,t.jsxs)(n.p,{children:["Description: set location for files and metadata to be downloaded to, include \\ escape character, can be unc path e.g.",(0,t.jsx)(n.code,{children:"\\\\\\\\vmware-host\\\\Shared Folders\\\\share"})]}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"D:\\\\ptc\\\\Virtalis_Download"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: check.for.state"}),"\n",(0,t.jsx)(n.p,{children:"Description: If true this will only download files/metadata if published EPMDocument is at a state specified in copy.publish.states property."}),"\n",(0,t.jsxs)(n.p,{children:["\u200dExample value: ",(0,t.jsx)(n.code,{children:"true"}),"\r\n\u200d"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: copy.publish.states"}),"\n",(0,t.jsx)(n.p,{children:"Description: States considered if check.for.state is true."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"InWork,Released,Controlled"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: force.republish"}),"\n",(0,t.jsx)(n.p,{children:"Description: If a positioning assembly representation already exists, when this property is set to true will overwrite the existing representation."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.host"}),"\n",(0,t.jsx)(n.p,{children:"Description: The IP address or hostname of the Virtalis Hub queue to which NotificationMessages will be published after an assembly is checked-in."}),"\n",(0,t.jsx)(n.p,{children:"If using peer-verification (see below) this value must match either the CN or SAN fields in the server\u2019s SSL certificate."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"123.456.789.098"})," or a hostname"]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.port"}),"\n",(0,t.jsx)(n.p,{children:"Description: The port number needed to connect to the Virtalis Hub queue."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"1234"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue,name"}),"\n",(0,t.jsx)(n.p,{children:"Description: The name of the Virtalis Hub queue to publish messages on. The value should never need changing from \u2018changes\u2019."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"changes"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.username"}),"\n",(0,t.jsx)(n.p,{children:"Description: The username required to connect to the Virtalis Hub queue (this is windchill by default if you follow the Pre-installation steps)."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"<queue-username>"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.password"}),"\n",(0,t.jsx)(n.p,{children:"Description: The password required to connect to the Virtalis Hub queue."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"<queue-password>"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.ssl"}),"\n",(0,t.jsx)(n.p,{children:"Description: Whether to use SSL to connect to the Virtalis Hub queue. Setting this alone to true will encrypt the traffic between the Plugin and Virtalis Hub but will not perform peer-verification checks (see below). Nevertheless, this adds a layer of security."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true/false"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.usePeerVerification"}),"\n",(0,t.jsx)(n.p,{children:"Description: If set to true (and queue.ssl is also true), will attempt to perform peer verification when connecting to the Virtalis Hub queue. This adds more security but requires client keys to be installed. See the section on SSL/TLS."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"true/false"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.client.key"}),"\n",(0,t.jsx)(n.p,{children:"Description: The client key. This file should be provided by a site administrator who provided the certificate used to secure the Virtalis Hub queue."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"D:/ptc/Virtalis_Download/truststore/client_key.p12"})}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: queue.trust.store"}),"\n",(0,t.jsx)(n.p,{children:"Description: This is where the Windchill plugin will store it\u2019s certificates & keys etc. Should be a Java keystore file."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"D:/ptc/Virtalis_Download/truststore/rabbitstore.jks"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: client.key.password"}),"\n",(0,t.jsx)(n.p,{children:"Description: The password for the client key specified in queue.client.key."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"<client-key-password>"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: trust.store.password"}),"\n",(0,t.jsx)(n.p,{children:"Description: The password for the trust store specified when generating certificates under the pre-installation section under \u201cCreate a keystore for windchill\u201d."}),"\n",(0,t.jsxs)(n.p,{children:["Example value: ",(0,t.jsx)(n.code,{children:"<trust-store-password>"})]}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: exportable.item.filters"}),"\n",(0,t.jsx)(n.p,{children:"Description: Regular expressions to limit which assemblies will be sent to Virtalis Hub. See the Filtering section for more information."}),"\n",(0,t.jsx)(n.p,{children:"Example value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:".*\\.asm\r\n\r\n.*\\.asm;.*\\.prt\r\n\r\n.*Aviation.*\\.asm;\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u200dProperty name: groups"}),"\n",(0,t.jsx)(n.p,{children:"Description: A comma-separated list of Virtalis Hub groups that the resulting asset will be available to (in Virtalis Hub)."}),"\n",(0,t.jsx)(n.p,{children:"Example value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"windchill\r\n\r\nwindchill,engineers\n"})}),"\n",(0,t.jsx)(n.h2,{id:"verifying-the-installation",children:"\u200dVerifying the Installation"}),"\n",(0,t.jsx)(n.p,{children:"Once installed and configured, restart the PTC Windchill service."}),"\n",(0,t.jsxs)(n.p,{children:["Locate the folder ",(0,t.jsx)(n.code,{children:"D:\\ptc\\Windchill_11.1\\Windchill\\logs"})," and monitor the most recent ",(0,t.jsx)(n.code,{children:"MethodServer-<date>-log4j.log"})," file. You should see messages appear like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"2021-03-18 23:01:01,242 INFO [main] wt.system.out - VirtalisPublish - Loading properties\r\n2021-03-18 23:01:01,245 INFO [main] wt.system.out - VirtalisPublish - Setting up logger\r\n2021-03-18 23:01:01,245 INFO [main] wt.system.out - VirtalisPublish - logger setup complete\n"})}),"\n",(0,t.jsx)(n.p,{children:"This indicates that the plugin has been successfully registered as a service within Windchill."}),"\n",(0,t.jsx)(n.p,{children:"Note, these are low-level log messages logged to stdout. After these messages appear, all future log messages from the plugin will be logged to the location specified by the configuration property copy.logger.location, which by default is D:\\ptc\\Virtalis_Download\\logs\\publisher.txt."}),"\n",(0,t.jsx)(n.h2,{id:"testing-the-plugin",children:"Testing the Plugin"}),"\n",(0,t.jsx)(n.p,{children:"Make a change to an assembly in Windchill and perform a check-in."}),"\n",(0,t.jsx)(n.p,{children:"Shortly after, you should see some activity in the log file specified as copy.logger.location (publisher.txt by default)."}),"\n",(0,t.jsx)(n.p,{children:"There should be a message similar to the following:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[2021-03-19 14:39:19.834]  - co.uk.rootsolutions.virtalis.StandardCopyRepsService - co.uk.rootsolutions.virtalis.MessageSender Message sent\n"})}),"\n",(0,t.jsx)(n.p,{children:"This indicates that Windchill has posted a message to the Virtalis Hub queue and you should see an import job running in the jobs screen in Virtalis Hub"}),"\n",(0,t.jsx)(n.p,{children:"If not, please refer to publisher.txt to see if there are any obvious error messages, the main Windchill logs, and the troubleshooting guide below."}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.p,{children:"###Test the Connection"}),"\n",(0,t.jsx)(n.p,{children:"We strongly recommend that before proceeding you test the Windchlll queue connection using the following commands. If there are connectivity issues in the future, the following can also assist with troubleshooting."}),"\n",(0,t.jsx)(n.p,{children:"Test the connection with the rabbitmq python client."}),"\n",(0,t.jsx)(n.p,{children:"Replace the variables wrapped in the # comment block and save file as mq.py:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'#!/usr/bin/env python3\r\nimport pika\r\nimport logging\r\nimport ssl\r\nlogging.basicConfig(level=logging.INFO)\r\n \r\n###\r\n### Replace everything in <> below\r\ncafile_path="<full path to dir>/ca_certificate.pem"\r\nclient_cert_path="<full path to dir>/client_certificate.pem"\r\nclient_key_path="<full path to dir>/client_key.pem"\r\nmq_domain="<rabbit message queue domain/address>"\r\nwindchill_mq_password="<windchill user password>"\r\n###\r\n###\r\ncontext = ssl.create_default_context(\r\n    cafile=cafile_path)\r\ncontext.load_cert_chain(client_cert_path,\r\n                        client_key_path)\r\nssl_options = pika.SSLOptions(context, mq_domain)\r\ncredentials = pika.PlainCredentials("windchill", windchill_mq_password)\r\nconnection = pika.BlockingConnection(pika.ConnectionParameters(host=mq_domain, port=5673,\r\nvirtual_host=\'/\', \r\ncredentials=credentials,\r\nssl_options=ssl_options\r\n))\r\n \r\nchannel = connection.channel()\n'})}),"\n",(0,t.jsx)(n.p,{children:"Install dependencies:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"pip3 install pika\r\nchmod +x mq.py\r\n./mq.py\n"})}),"\n",(0,t.jsx)(n.p,{children:"The connection should be instantly accepted and then closed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"root@master:~# ./mq.py \r\nINFO:pika.adapters.utils.connection_workflow:Pika version 1.1.0 connecting to ('10.209.65.143', 5673)\r\nINFO:pika.adapters.utils.io_services_utils:Socket connected: <socket.socket fd=6, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.209.65.143', 45154), raddr=('10.209.65.143', 5673)>\r\nINFO:pika.adapters.utils.io_services_utils:SSL handshake completed successfully: <ssl.SSLSocket fd=6, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.209.65.143', 45154), raddr=('10.209.65.143', 5673)>\r\nINFO:pika.adapters.utils.connection_workflow:Streaming transport linked up: (<pika.adapters.utils.io_services_utils._AsyncSSLTransport object at 0x7fd7c7550910>, _StreamingProtocolShim: <SelectConnection PROTOCOL transport=<pika.adapters.utils.io_services_utils._AsyncSSLTransport object at 0x7fd7c7550910> params=<ConnectionParameters host=hub.local port=5673 virtual_host=/ ssl=True>>).\r\nINFO:pika.adapters.utils.connection_workflow:AMQPConnector - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncSSLTransport object at 0x7fd7c7550910> params=<ConnectionParameters host=hub.local port=5673 virtual_host=/ ssl=True>>\r\nINFO:pika.adapters.utils.connection_workflow:AMQPConnectionWorkflow - reporting success: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncSSLTransport object at 0x7fd7c7550910> params=<ConnectionParameters host=hub.local port=5673 virtual_host=/ ssl=True>>\r\nINFO:pika.adapters.blocking_connection:Connection workflow succeeded: <SelectConnection OPEN transport=<pika.adapters.utils.io_services_utils._AsyncSSLTransport object at 0x7fd7c7550910> params=<ConnectionParameters host=hub.local port=5673 virtual_host=/ ssl=True>>\r\nINFO:pika.adapters.blocking_connection:Created channel=1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"windchill-doesnt-start-after-installing-the-plugin",children:"\u200dWindchill Doesn\u2019t Start After Installing the Plugin"}),"\n",(0,t.jsxs)(n.p,{children:["Check the main Windchill logs, which can be found in ",(0,t.jsx)(n.code,{children:"<install-folder>/logs"}),". There are lots of different log files, you should first check ",(0,t.jsx)(n.code,{children:"MethodServer-xxxxxxxxxxxx.log"})," and ",(0,t.jsx)(n.code,{children:"BackgroundMethodServer-xxxxxxxxxxxx.log"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Nothing Happens After Performing a Check-in on an Assembly\r\nCheck the main logs in ",(0,t.jsx)(n.code,{children:"<install-folder>/logs"})," for errors."]}),"\n",(0,t.jsxs)(n.p,{children:["Check the log file of the VirtalisPublish plugin for errors. This is the file specified by the ",(0,t.jsx)(n.code,{children:"copy.logger.location"})," configuration property in ",(0,t.jsx)(n.code,{children:"virtalisPublish.properties"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Check the Worker Agent to see if the job was processed. You can access the worker agent jobs by logging into Windchill as an admin user and choosing Browse > Site > Utilities."}),"\n",(0,t.jsx)(n.p,{children:"You can see the general health of the Worker Agent in the window that opens up:"}),"\n",(0,t.jsx)(n.p,{children:"There should be a PROE worker registered. This performs the work after a check-in and is required for the VirtalisPublish plugin to be triggered. Ask your Windchill server administrator to assist if the worker is not there. If it is listed but says anything other than \u2018Available\u2019 in the Job column, or the check against \u2018On-Line\u2019 is missing, you can try restarting it using the green flag icon in the appropriate row."}),"\n",(0,t.jsx)(n.p,{children:"Check the WVS Job Monitor to see if the job failed. You can access this via Quick Links > WVS Job Monitor."}),"\n",(0,t.jsx)(n.p,{children:"You might see a message saying that the publishing job failed. Note, this is Windchill\u2019s internal publishing job (performed by the Worker)."}),"\n",(0,t.jsx)(n.p,{children:"If you see an error similar to the one shown below, you will need to contact the Windchill server administrator to find out why the PROE Worker Agent isn\u2019t working. It could be that the PROE licence has expired or any number of other reasons."}),"\n",(0,t.jsx)(n.h3,{id:"worker-agent-fails-to-start",children:"Worker Agent Fails to Start"}),"\n",(0,t.jsx)(n.p,{children:"The worker agent can also fail to start if the license for Creo Parametric has expired. You may see these errors in the worker agent logs as it tries to start:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'[2022-02-16 10:28:30] timestamps added to logging from command argument.\r\n\r\n[2022-02-16 10:28:30] workerhelper - Version : Creo 6.0.0.0 - (16.0.0.24) x86e_win64\r\n\r\n[2022-02-16 10:28:30] Increasing initial timeout to 180 seconds from command line to accomodate helper startup sleep time.\r\n\r\n[2022-02-16 10:28:30] Connecting to server "rootwindchill.virtalis.local" on port 5600\r\n\r\n[2022-02-16 10:28:30] Connection established\r\n\r\n[2022-02-16 10:28:30] Helper keep alive set - 300000 milliseconds\r\n\r\n[2022-02-16 10:28:31] Worker Cache Cleared\r\n\r\n[2022-02-16 10:28:31] Started worker\r\n\r\n[2022-02-16 10:28:36] Worker process 9004 has exited unexpectedly. Shutting down helper.\r\n\r\n[2022-02-16 10:28:36] Worker helper shutting down.\r\n\r\n[2022-02-16 10:28:36] WorkerHelper completed, exiting\n'})}),"\n",(0,t.jsx)(n.p,{children:"These are indicative of a Creo Parametric license error which you can then confirm by running Creo Parametric. If Creo Parametric generates a license error at startup then contact the Windchill server administrator."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var r=i(96540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);