"use strict";(self.webpackChunkvirtalis_docs=self.webpackChunkvirtalis_docs||[]).push([[37849],{94660:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"virtalis-hub-system-admin/configure/erase-data","title":"Manually Erasing Data","description":"Virtalis Hub does not provide a GUI mechanism to delete visualisations from the artifact store or models from the hub. This document is designed to help a systems administrator achieve that outcome.","source":"@site/docs/virtalis-hub-system-admin/configure/erase-data.mdx","sourceDirName":"virtalis-hub-system-admin/configure","slug":"/virtalis-hub-system-admin/configure/erase-data","permalink":"/virtalis-hub-system-admin/configure/erase-data","draft":false,"unlisted":false,"editUrl":"https://github.com/virtalis/docs/tree/master/docs/virtalis-hub-system-admin/configure/erase-data.mdx","tags":[],"version":"current","lastUpdatedAt":1742892037000,"frontMatter":{},"sidebar":"virtalisHubSystemAdminSidebar","previous":{"title":"Change the Domain of an Existing Installation","permalink":"/virtalis-hub-system-admin/configure/change-domain"},"next":{"title":"Mesh Splitting Overview and Configuration","permalink":"/virtalis-hub-system-admin/configure/mesh-splitting"}}');var r=n(74848),s=n(28453);const a={},l="Manually Erasing Data",o={},c=[{value:"Pre-installation",id:"pre-installation",level:2},{value:"Installing the service",id:"installing-the-service",level:3},{value:"Erase an Artifact",id:"erase-an-artifact",level:2},{value:"Deleting VRModels",id:"deleting-vrmodels",level:2},{value:"Turn Off the Service",id:"turn-off-the-service",level:2},{value:"On Data Reuse Between Data Stores",id:"on-data-reuse-between-data-stores",level:2}];function d(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"manually-erasing-data",children:"Manually Erasing Data"})}),"\n",(0,r.jsx)(t.p,{children:"Virtalis Hub does not provide a GUI mechanism to delete visualisations from the artifact store or models from the hub. This document is designed to help a systems administrator achieve that outcome."}),"\n",(0,r.jsxs)(t.p,{children:["This section assumes that you have already installed Virtalis Hub and your shell is in the directory containing the files that were downloaded during the installation, this is usually stored in the home directory, for example ",(0,r.jsx)(t.code,{children:"/home/root/Hub/k8s"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:"The actions in this document directly modify the databases used by the Virtalis Hub services. No consideration is given to the current activity of the system and system wide transactions are not used. Before performing these actions prevent access to users of the system by temporarily disabling the ingress server."})}),"\n",(0,r.jsx)(t.h2,{id:"pre-installation",children:"Pre-installation"}),"\n",(0,r.jsx)(t.p,{children:"Before continuing with the next section, please refer to Virtalis Hub Automated Backup System and perform a full backup of the system."}),"\n",(0,r.jsx)(t.h3,{id:"installing-the-service",children:"Installing the service"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"export HUB_NAMESPACE=hub\r\nhelm install hub-data-eraser -n $HUB_NAMESPACE data-eraser/chart/ \n"})}),"\n",(0,r.jsx)(t.p,{children:"Turn On the Service"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"kubectl scale statefulset -n $HUB_NAMESPACE hub-data-eraser --replicas=1\n"})}),"\n",(0,r.jsx)(t.p,{children:"List arguments:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:' kubectl exec -it -n $HUB_NAMESPACE \\\r\n hub-data-eraser-0 -- /bin/bash -c \\\r\n "/del-obj.py --help"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Output:"}),"\n",(0,r.jsxs)(t.p,{children:["usage: ",(0,r.jsx)(t.code,{children:"del-obj.py [-h] [-t TYPE] [-d DELETE] [-l] [-s] [-T]"})]}),"\n",(0,r.jsx)(t.p,{children:"Deletes visualisation artifacts and vrmodels from Virtalis Hub"}),"\n",(0,r.jsx)(t.p,{children:"optional arguments:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"  -h, --help            show this help message and exit\r\n  -t TYPE, --type TYPE  Choose data type to erase, either 'artifact' or 'vrmodel' (default artifact)\r\n  -d DELETE, --delete DELETE\r\n                        Deletes artifact or vrmodel by ID\r\n  -l, --list            List artifacts or vrmodels\r\n  -s, --size            List total size of artifacts or vrmodels. This will increase the time to retrieve the list depending on how much data is currently stored.\r\n  -T, --test            Dry run - test delete\n"})}),"\n",(0,r.jsx)(t.p,{children:"\u200d\r\nTemporarily Disabling the Ingress Service\r\nNote down the replica count for nginx before scaling it down:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"kubectl get deploy -n ingress-nginx \r\nexport NGINX_REPLICAS=<CURRENT_REPLICA_COUNT>\n"})}),"\n",(0,r.jsx)(t.p,{children:"Scale down the nginx ingress service to prevent people from accessing Virtalis Hub during the deletion process:"}),"\n",(0,r.jsx)(t.p,{children:"Deleting a Visualisation Artifact"}),"\n",(0,r.jsx)(t.p,{children:"List Artifacts to Extract Artifact IDs"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'kubectl exec -it -n $HUB_NAMESPACE \\\r\n hub-data-eraser-0 -- /bin/bash -c \\\r\n "/del-obj.py --list"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Sample output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"Connecting to Neo4j bolt://localhost:7687\r\nJustAPointList : ID 8f3885c5-03ec-492f-9fca-8119ad2f4962\r\nassembled : ID 787eae34-5764-4105-a50f-c441c100f66e\r\nlight_test_plus_cube : ID 7ae36ec6-ea6b-4639-973f-8fd16179b262\r\ntemplate_torusknot : ID ebd7d8fe-a846-4b70-ac86-01c275e5f3b1\r\ntemplate_torusknot : ID 81894536-d0d8-454e-816e-3db87d1e58c8\n"})}),"\n",(0,r.jsx)(t.p,{children:"The above list will show each revision separately."}),"\n",(0,r.jsx)(t.p,{children:"As you can see, there are 2 revisions of template_torusknot You can use the UUID to cross-reference which version this refers to so that you can make sure you are deleting the right revision."}),"\n",(0,r.jsxs)(t.p,{children:["In a web browser, navigate to the following URL, replacing ",(0,r.jsx)(t.code,{children:"<UUID>"})," with the UUID of the artifact you want to check and replacing ",(0,r.jsx)(t.code,{children:"<YOUR_DOMAIN>"})," with the domain of your Virtalis Hub installation."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"https://<YOUR_DOMAIN>/viewer/<UUID>\n"})}),"\n",(0,r.jsx)(t.p,{children:"Once opened, you can click the \u201cShow all versions\u201d link to bring up a list of all versions along with the information about the current revision."}),"\n",(0,r.jsx)(t.h2,{id:"erase-an-artifact",children:"Erase an Artifact"}),"\n",(0,r.jsx)(t.p,{children:"Optional but recommended, use the -T switch to test the deletion procedure without affecting the database."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'kubectl exec -it -n $HUB_NAMESPACE \\\r\n hub-data-eraser-0 -- /bin/bash -c \\\r\n "/del-obj.py --test --delete f4a356df-823f-424c-a6c9-2bc763ef9a41"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Sample output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"Checking cachedxml/3b3a3f44ec5977f17cb5239030945f6063f9cf91b433909b01e779a89d4830be\r\nOK\r\nDeleting from meshes\r\nDeleting from textures\r\nDeleting from cachedxml\r\nDeleting cachedxml/3b3a3f44ec5977f17cb5239030945f6063f9cf91b433909b01e779a89d4830be\r\nOK\n"})}),"\n",(0,r.jsx)(t.p,{children:"Remove the -T switch to delete the data."}),"\n",(0,r.jsx)(t.p,{children:"Input:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'kubectl exec -it -n $HUB_NAMESPACE \\\r\n hub-data-eraser-0 -- /bin/bash -c \\\r\n "/del-obj.py --delete f4a356df-823f-424c-a6c9-2bc763ef9a41"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Sample output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"Checking cachedxml/3b3a3f44ec5977f17cb5239030945f6063f9cf91b433909b01e779a89d4830be\r\nOK\r\nDeleting from meshes\r\nDeleting from textures\r\nDeleting from cachedxml\r\nDeleting cachedxml/3b3a3f44ec5977f17cb5239030945f6063f9cf91b433909b01e779a89d4830be\r\nOK\n"})}),"\n",(0,r.jsx)(t.h2,{id:"deleting-vrmodels",children:"Deleting VRModels"}),"\n",(0,r.jsx)(t.p,{children:"The process for deleting VRModels is the same as deleting visualisation artifacts except that the object type should be change from the default of artifact to vrmodel using the -t or --type parameter."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'kubectl exec -it -n $HUB_NAMESPACE \\\r\n hub-data-eraser-0 -- /bin/bash -c \\\r\n "/del-obj.py --list --type vrmodel"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Sample output:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"JustAPointList : ID a1e0544c-8985-4ca0-a50c-1856a81c7ca5\r\nNX_Speedboat : ID 3232ae07-b0bd-4f3b-ac1d-c595126a8b20\r\nSYSTEM_FILTER_BOX_WA_1_5T : ID 141d6136-3ba8-4a08-8462-8aa23e63ed5b\r\nSolid Edge 853 : ID 3b3ca5ec-589a-4582-bf85-65603872985e\r\nTwoModelsSameName : ID 86cbc92c-5159-4260-bd4a-22265debfa58\n"})}),"\n",(0,r.jsx)(t.h2,{id:"turn-off-the-service",children:"Turn Off the Service"}),"\n",(0,r.jsx)(t.p,{children:"Once done, scale down the service:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"kubectl scale statefulset -n $HUB_NAMESPACE hub-data-eraser --replicas=0\n"})}),"\n",(0,r.jsx)(t.h2,{id:"on-data-reuse-between-data-stores",children:"On Data Reuse Between Data Stores"}),"\n",(0,r.jsx)(t.p,{children:"Binary data items may be referenced by multiple artifacts. For example, when a model is reused in different projects or by revisions of a project. Only when deletion of an artifact will result in the related binary data items being unreferenced will they be deleted."}),"\n",(0,r.jsx)(t.p,{children:"In the diagram below, the deletion of Visualisation A will no result in the deletion of the LOD Binary data because it is also referenced by Visualisation B. If A is first deleted then the LOD binary data will be referenced only by B, then when B is deleted and the LOD Binary data will also be deleted."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var i=n(96540);const r={},s=i.createContext(r);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);